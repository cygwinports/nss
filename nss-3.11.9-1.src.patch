--- origsrc/nss-3.11.9/mozilla/dbm/include/mcom_db.h	2005-09-22 05:38:06.000000000 -0500
+++ src/nss-3.11.9/mozilla/dbm/include/mcom_db.h	2008-05-02 14:11:51.765625000 -0500
@@ -59,7 +59,7 @@
 #include <sys/byteorder.h>
 #endif
 
-#if defined(__linux) || defined(__BEOS__)
+#if defined(__linux) || defined(__BEOS__) || defined(__CYGWIN__)
 #include <endian.h>
 #ifndef BYTE_ORDER
 #define BYTE_ORDER    __BYTE_ORDER
@@ -235,6 +235,10 @@
 
 #define	MAX_PAGE_NUMBER	0xffffffff	/* >= # of pages in a file */
 
+#ifdef __CYGWIN__
+typedef unsigned int uint;
+#endif
+
 #ifndef __sgi
 typedef uint32	pgno_t;
 #endif
--- origsrc/nss-3.11.9/mozilla/security/coreconf/CYGWIN.mk	1969-12-31 18:00:00.000000000 -0600
+++ src/nss-3.11.9/mozilla/security/coreconf/CYGWIN.mk	2008-05-02 14:11:51.828125000 -0500
@@ -0,0 +1,134 @@
+#
+# ***** BEGIN LICENSE BLOCK *****
+# Version: MPL 1.1/GPL 2.0/LGPL 2.1
+#
+# The contents of this file are subject to the Mozilla Public License Version
+# 1.1 (the "License"); you may not use this file except in compliance with
+# the License. You may obtain a copy of the License at
+# http://www.mozilla.org/MPL/
+#
+# Software distributed under the License is distributed on an "AS IS" basis,
+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
+# for the specific language governing rights and limitations under the
+# License.
+#
+# The Original Code is the Netscape security libraries.
+#
+# The Initial Developer of the Original Code is
+# Netscape Communications Corporation.
+# Portions created by the Initial Developer are Copyright (C) 1994-2000
+# the Initial Developer. All Rights Reserved.
+#
+# Contributor(s):
+#
+# Alternatively, the contents of this file may be used under the terms of
+# either the GNU General Public License Version 2 or later (the "GPL"), or
+# the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
+# in which case the provisions of the GPL or the LGPL are applicable instead
+# of those above. If you wish to allow use of your version of this file only
+# under the terms of either the GPL or the LGPL, and not to allow others to
+# use your version of this file under the terms of the MPL, indicate your
+# decision by deleting the provisions above and replace them with the notice
+# and other provisions required by the GPL or the LGPL. If you do not delete
+# the provisions above, a recipient may use your version of this file under
+# the terms of any one of the MPL, the GPL or the LGPL.
+#
+# ***** END LICENSE BLOCK *****
+
+XP_DEFINE  += -DXP_UNIX
+AR          = ar cr $@
+LDOPTS     += -L$(SOURCE_LIB_DIR)
+LIB_PREFIX	= lib
+LIB_SUFFIX	= a
+DLL_PREFIX	= cyg
+DLL_SUFFIX	= dll
+IMPORT_LIB_SUFFIX	= .dll.a
+DYNAMIC_LIB_SUFFIX_FOR_LINKING = $(IMPORT_LIB_SUFFIX)
+PROG_SUFFIX	= .exe
+
+ifdef BUILD_OPT
+	OPTIMIZER  += -O
+	DEFINES    += -UDEBUG -DNDEBUG
+else
+	OPTIMIZER  += -g
+	DEFINES    += -DDEBUG -UNDEBUG -DDEBUG_$(shell whoami)
+endif
+
+ifdef BUILD_TREE
+NSINSTALL_DIR  = $(BUILD_TREE)/nss
+NSINSTALL      = $(BUILD_TREE)/nss/nsinstall
+else
+NSINSTALL_DIR  = $(CORE_DEPTH)/coreconf/nsinstall
+NSINSTALL      = $(NSINSTALL_DIR)/$(OBJDIR_NAME)/nsinstall
+endif
+
+MKDEPEND_DIR    = $(CORE_DEPTH)/coreconf/mkdepend
+MKDEPEND        = $(MKDEPEND_DIR)/$(OBJDIR_NAME)/mkdepend
+MKDEPENDENCIES  = $(OBJDIR_NAME)/depend.mk
+
+####################################################################
+#
+# One can define the makefile variable NSDISTMODE to control
+# how files are published to the 'dist' directory.  If not
+# defined, the default is "install using relative symbolic
+# links".  The two possible values are "copy", which copies files
+# but preserves source mtime, and "absolute_symlink", which
+# installs using absolute symbolic links.
+#   - THIS IS NOT PART OF THE NEW BINARY RELEASE PLAN for 9/30/97
+#   - WE'RE KEEPING IT ONLY FOR BACKWARDS COMPATIBILITY
+####################################################################
+
+INSTALL = $(NSINSTALL) -t
+
+define MAKE_OBJDIR
+if test ! -d $(@D); then rm -rf $(@D); $(NSINSTALL) -D $(@D); fi
+endef
+
+#
+# The default implementation strategy for Cygwin is pthreads
+#
+USE_PTHREADS = 1
+IMPL_STRATEGY = _PTH
+
+CC			= gcc
+CCC			= g++
+RANLIB			= ranlib
+
+DEFAULT_COMPILER = gcc
+
+OS_REL_CFLAGS	= -DCYGWIN -Di386 -D_XOPEN_SOURCE
+CPU_ARCH	= x86
+
+#ifdef BUILD_OPT
+#	OPTIMIZER	= -O2
+#endif
+
+ifdef USE_PTHREADS
+	DEFINES		+= -D_REENTRANT
+endif
+
+ifeq ($(USE_PTHREADS),1)
+OS_PTHREAD = -lpthread 
+endif
+
+OS_CFLAGS		= $(DSO_CFLAGS) $(OS_REL_CFLAGS) $(ARCHFLAG) -ansi -Wall -pipe -D_POSIX_SOURCE -D_BSD_SOURCE -DHAVE_STRERROR -I/usr/include/nspr
+OS_LIBS			= $(OS_PTHREAD)
+
+MKSHLIB		= $(CC) -shared -Wl,--enable-auto-image-base $(_GEN_IMPORT_LIB) $(LDFLAGS)
+
+ARCH			= cygwin
+
+DSO_CFLAGS		= -DPIC -DDLL_EXPORT
+DSO_LDOPTS		= -shared $(ARCHFLAG)
+DSO_LDFLAGS		=
+LDFLAGS			+= $(ARCHFLAG) -L/usr/lib/nspr
+
+ifdef LIBRARY_NAME
+	SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(JDK_DEBUG_SUFFIX).$(DLL_SUFFIX)
+	IMPORT_LIBRARY = $(OBJDIR)/$(LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(JDK_DEBUG_SUFFIX)$(IMPORT_LIB_SUFFIX)
+	_GEN_IMPORT_LIB	= -Wl,--out-implib,$(IMPORT_LIBRARY)
+endif
+
+ifndef TARGETS
+	TARGETS = $(LIBRARY) $(SHARED_LIBRARY) $(IMPORT_LIBRARY) $(PROGRAM)
+endif
--- origsrc/nss-3.11.9/mozilla/security/coreconf/arch.mk	2007-11-14 16:47:33.000000000 -0600
+++ src/nss-3.11.9/mozilla/security/coreconf/arch.mk	2008-05-02 14:11:51.843750000 -0500
@@ -257,7 +257,7 @@
 #
 ifeq (CYGWIN_NT,$(findstring CYGWIN_NT,$(OS_ARCH)))
     OS_RELEASE := $(patsubst CYGWIN_NT-%,%,$(OS_ARCH))
-    OS_ARCH = WINNT
+    OS_ARCH = CYGWIN
     ifndef CPU_ARCH
     ifeq (WOW64,$(findstring WOW64,$(OS_RELEASE)))
         OS_RELEASE := $(patsubst %-WOW64,%,$(OS_RELEASE))
--- origsrc/nss-3.11.9/mozilla/security/coreconf/config.mk	2007-05-04 01:54:05.000000000 -0500
+++ src/nss-3.11.9/mozilla/security/coreconf/config.mk	2008-05-02 14:11:51.875000000 -0500
@@ -63,7 +63,7 @@
 #######################################################################
 
 TARGET_OSES = FreeBSD BSD_OS NetBSD OpenUNIX OS2 QNX Darwin BeOS OpenBSD \
-              OpenVMS AIX
+              OpenVMS AIX CYGWIN
 
 ifeq (,$(filter-out $(TARGET_OSES),$(OS_TARGET)))
 include $(CORE_DEPTH)/coreconf/$(OS_TARGET).mk
--- origsrc/nss-3.11.9/mozilla/security/nss/cmd/shlibsign/Makefile	2006-12-06 19:59:40.000000000 -0600
+++ src/nss-3.11.9/mozilla/security/nss/cmd/shlibsign/Makefile	2008-05-02 14:11:51.921875000 -0500
@@ -60,9 +60,9 @@
 
 # sign any and all shared libraries that contain the word freebl
 
-CHECKLIBS = $(DIST)/lib/$(DLL_PREFIX)softokn3.$(DLL_SUFFIX)
-CHECKLIBS += $(wildcard $(DIST)/lib/$(DLL_PREFIX)freebl*3.$(DLL_SUFFIX))
-CHECKLOC = $(CHECKLIBS:.$(DLL_SUFFIX)=.chk)
+#CHECKLIBS = $(DIST)/lib/$(DLL_PREFIX)softokn3.$(DLL_SUFFIX)
+#CHECKLIBS += $(wildcard $(DIST)/lib/$(DLL_PREFIX)freebl*3.$(DLL_SUFFIX))
+#CHECKLOC = $(CHECKLIBS:.$(DLL_SUFFIX)=.chk)
 
 MD_LIB_RELEASE_FILES = $(CHECKLOC)
 ALL_TRASH += $(CHECKLOC)
--- origsrc/nss-3.11.9/mozilla/security/nss/cmd/shlibsign/sign.sh	2006-01-18 14:59:07.000000000 -0600
+++ src/nss-3.11.9/mozilla/security/nss/cmd/shlibsign/sign.sh	2008-05-02 14:11:51.953125000 -0500
@@ -1,5 +1,13 @@
 #!/bin/sh
 case "${3}" in
+CYGWIN*)
+    PATH="${1}/lib:${1}/bin:${PATH}"
+    export PATH
+	ADDON_PATH=${1}/lib:${4}:$ADDON_PATH
+	export ADDON_PATH
+    echo ${2}/shlibsign -v -i ${5}
+    ${2}/shlibsign -v -i ${5}
+    ;;
 WIN*)
     if echo "${PATH}" | grep -c \; >/dev/null; then
         PATH=${1}/lib\;${1}/bin\;${4}\;${PATH}
--- origsrc/nss-3.11.9/mozilla/security/nss/lib/ckfw/builtins/config.mk	2005-01-19 20:25:46.000000000 -0600
+++ src/nss-3.11.9/mozilla/security/nss/lib/ckfw/builtins/config.mk	2008-05-02 14:11:51.968750000 -0500
@@ -43,7 +43,6 @@
 
 TARGETS        = $(SHARED_LIBRARY)
 LIBRARY        =
-IMPORT_LIBRARY =
 PROGRAM        =
 
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
--- origsrc/nss-3.11.9/mozilla/security/nss/lib/freebl/config.mk	2006-09-01 17:10:58.000000000 -0500
+++ src/nss-3.11.9/mozilla/security/nss/lib/freebl/config.mk	2008-05-02 14:11:51.984375000 -0500
@@ -70,7 +70,6 @@
 
 TARGETS      = $(SHARED_LIBRARY)
 LIBRARY      =
-IMPORT_LIBRARY =
 PROGRAM      =
 
 EXTRA_LIBS   += $(DIST)/lib/$(LIB_PREFIX)secutil.$(LIB_SUFFIX)
--- origsrc/nss-3.11.9/mozilla/security/nss/lib/freebl/unix_rand.c	2007-07-25 18:18:55.000000000 -0500
+++ src/nss-3.11.9/mozilla/security/nss/lib/freebl/unix_rand.c	2008-05-02 14:11:52.015625000 -0500
@@ -185,7 +185,7 @@
 #endif
 
 #if defined(SCO) || defined(UNIXWARE) || defined(BSDI) || defined(FREEBSD) \
-    || defined(NETBSD) || defined(NTO) || defined(DARWIN) || defined(OPENBSD)
+    || defined(NETBSD) || defined(NTO) || defined(DARWIN) || defined(OPENBSD) || defined(CYGWIN)
 #include <sys/times.h>
 
 #define getdtablesize() sysconf(_SC_OPEN_MAX)
@@ -211,8 +211,10 @@
     si = sysconf(_SC_CHILD_MAX);
     RNG_RandomUpdate(&si, sizeof(si));
 
+#if defined(_SC_STREAM_MAX)
     si = sysconf(_SC_STREAM_MAX);
     RNG_RandomUpdate(&si, sizeof(si));
+#endif
 
     si = sysconf(_SC_OPEN_MAX);
     RNG_RandomUpdate(&si, sizeof(si));
