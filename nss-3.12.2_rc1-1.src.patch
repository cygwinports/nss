--- origsrc/mozilla/dbm/include/mcom_db.h	2005-09-22 05:38:06.000000000 -0500
+++ src/mozilla/dbm/include/mcom_db.h	2008-12-31 22:22:57.940625000 -0600
@@ -59,7 +59,7 @@
 #include <sys/byteorder.h>
 #endif
 
-#if defined(__linux) || defined(__BEOS__)
+#if defined(__linux) || defined(__BEOS__) || defined(__CYGWIN__)
 #include <endian.h>
 #ifndef BYTE_ORDER
 #define BYTE_ORDER    __BYTE_ORDER
@@ -235,6 +235,10 @@ PR_END_EXTERN_C
 
 #define	MAX_PAGE_NUMBER	0xffffffff	/* >= # of pages in a file */
 
+#ifdef __CYGWIN__
+typedef unsigned int uint;
+#endif
+
 #ifndef __sgi
 typedef uint32	pgno_t;
 #endif
--- origsrc/mozilla/security/coreconf/CYGWIN.mk	1969-12-31 18:00:00.000000000 -0600
+++ src/mozilla/security/coreconf/CYGWIN.mk	2008-12-31 22:22:57.956250000 -0600
@@ -0,0 +1,134 @@
+#
+# ***** BEGIN LICENSE BLOCK *****
+# Version: MPL 1.1/GPL 2.0/LGPL 2.1
+#
+# The contents of this file are subject to the Mozilla Public License Version
+# 1.1 (the "License"); you may not use this file except in compliance with
+# the License. You may obtain a copy of the License at
+# http://www.mozilla.org/MPL/
+#
+# Software distributed under the License is distributed on an "AS IS" basis,
+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
+# for the specific language governing rights and limitations under the
+# License.
+#
+# The Original Code is the Netscape security libraries.
+#
+# The Initial Developer of the Original Code is
+# Netscape Communications Corporation.
+# Portions created by the Initial Developer are Copyright (C) 1994-2000
+# the Initial Developer. All Rights Reserved.
+#
+# Contributor(s):
+#
+# Alternatively, the contents of this file may be used under the terms of
+# either the GNU General Public License Version 2 or later (the "GPL"), or
+# the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
+# in which case the provisions of the GPL or the LGPL are applicable instead
+# of those above. If you wish to allow use of your version of this file only
+# under the terms of either the GPL or the LGPL, and not to allow others to
+# use your version of this file under the terms of the MPL, indicate your
+# decision by deleting the provisions above and replace them with the notice
+# and other provisions required by the GPL or the LGPL. If you do not delete
+# the provisions above, a recipient may use your version of this file under
+# the terms of any one of the MPL, the GPL or the LGPL.
+#
+# ***** END LICENSE BLOCK *****
+
+XP_DEFINE  += -DXP_UNIX
+AR          = ar cr $@
+LDOPTS     += -L$(SOURCE_LIB_DIR)
+LIB_PREFIX	= lib
+LIB_SUFFIX	= a
+DLL_PREFIX	= cyg
+DLL_SUFFIX	= dll
+IMPORT_LIB_SUFFIX	= .dll.a
+DYNAMIC_LIB_SUFFIX_FOR_LINKING = $(IMPORT_LIB_SUFFIX)
+PROG_SUFFIX	= .exe
+
+ifdef BUILD_OPT
+	OPTIMIZER  += -O
+	DEFINES    += -UDEBUG -DNDEBUG
+else
+	OPTIMIZER  += -g
+	DEFINES    += -DDEBUG -UNDEBUG -DDEBUG_$(shell whoami)
+endif
+
+ifdef BUILD_TREE
+NSINSTALL_DIR  = $(BUILD_TREE)/nss
+NSINSTALL      = $(BUILD_TREE)/nss/nsinstall
+else
+NSINSTALL_DIR  = $(CORE_DEPTH)/coreconf/nsinstall
+NSINSTALL      = $(NSINSTALL_DIR)/$(OBJDIR_NAME)/nsinstall
+endif
+
+MKDEPEND_DIR    = $(CORE_DEPTH)/coreconf/mkdepend
+MKDEPEND        = $(MKDEPEND_DIR)/$(OBJDIR_NAME)/mkdepend
+MKDEPENDENCIES  = $(OBJDIR_NAME)/depend.mk
+
+####################################################################
+#
+# One can define the makefile variable NSDISTMODE to control
+# how files are published to the 'dist' directory.  If not
+# defined, the default is "install using relative symbolic
+# links".  The two possible values are "copy", which copies files
+# but preserves source mtime, and "absolute_symlink", which
+# installs using absolute symbolic links.
+#   - THIS IS NOT PART OF THE NEW BINARY RELEASE PLAN for 9/30/97
+#   - WE'RE KEEPING IT ONLY FOR BACKWARDS COMPATIBILITY
+####################################################################
+
+INSTALL = $(NSINSTALL) -t
+
+define MAKE_OBJDIR
+if test ! -d $(@D); then rm -rf $(@D); $(NSINSTALL) -D $(@D); fi
+endef
+
+#
+# The default implementation strategy for Cygwin is pthreads
+#
+USE_PTHREADS = 1
+IMPL_STRATEGY = _PTH
+
+CC			= gcc
+CCC			= g++
+RANLIB			= ranlib
+
+DEFAULT_COMPILER = gcc
+
+OS_REL_CFLAGS	= -DCYGWIN -Di386 -D_XOPEN_SOURCE
+CPU_ARCH	= x86
+
+#ifdef BUILD_OPT
+#	OPTIMIZER	= -O2
+#endif
+
+ifdef USE_PTHREADS
+	DEFINES		+= -D_REENTRANT
+endif
+
+ifeq ($(USE_PTHREADS),1)
+OS_PTHREAD = -lpthread 
+endif
+
+OS_CFLAGS		= $(DSO_CFLAGS) $(OS_REL_CFLAGS) $(ARCHFLAG) -ansi -Wall -pipe -D_POSIX_SOURCE -D_BSD_SOURCE -DHAVE_STRERROR -I/usr/include/nspr
+OS_LIBS			= $(OS_PTHREAD)
+
+MKSHLIB		= $(CC) -shared -Wl,--enable-auto-image-base $(_GEN_IMPORT_LIB) $(LDFLAGS)
+
+ARCH			= cygwin
+
+DSO_CFLAGS		= -DPIC -DDLL_EXPORT
+DSO_LDOPTS		= -shared $(ARCHFLAG)
+DSO_LDFLAGS		=
+LDFLAGS			+= $(ARCHFLAG) -L/usr/lib/nspr
+
+ifdef LIBRARY_NAME
+	SHARED_LIBRARY = $(OBJDIR)/$(DLL_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(JDK_DEBUG_SUFFIX).$(DLL_SUFFIX)
+	IMPORT_LIBRARY = $(OBJDIR)/$(LIB_PREFIX)$(LIBRARY_NAME)$(LIBRARY_VERSION)$(JDK_DEBUG_SUFFIX)$(IMPORT_LIB_SUFFIX)
+	_GEN_IMPORT_LIB	= -Wl,--out-implib,$(IMPORT_LIBRARY)
+endif
+
+ifndef TARGETS
+	TARGETS = $(LIBRARY) $(SHARED_LIBRARY) $(IMPORT_LIBRARY) $(PROGRAM)
+endif
--- origsrc/mozilla/security/coreconf/arch.mk	2007-11-14 16:49:43.000000000 -0600
+++ src/mozilla/security/coreconf/arch.mk	2008-12-31 22:22:57.956250000 -0600
@@ -257,7 +257,7 @@ endif
 #
 ifeq (CYGWIN_NT,$(findstring CYGWIN_NT,$(OS_ARCH)))
     OS_RELEASE := $(patsubst CYGWIN_NT-%,%,$(OS_ARCH))
-    OS_ARCH = WINNT
+    OS_ARCH = CYGWIN
     ifndef CPU_ARCH
     ifeq (WOW64,$(findstring WOW64,$(OS_RELEASE)))
         OS_RELEASE := $(patsubst %-WOW64,%,$(OS_RELEASE))
--- origsrc/mozilla/security/coreconf/config.mk	2008-05-09 18:55:54.000000000 -0500
+++ src/mozilla/security/coreconf/config.mk	2008-12-31 22:21:40.737500000 -0600
@@ -63,7 +63,7 @@ endif
 #######################################################################
 
 TARGET_OSES = FreeBSD BSD_OS NetBSD OpenUNIX OS2 QNX Darwin BeOS OpenBSD \
-              OpenVMS AIX RISCOS
+              OpenVMS AIX RISCOS CYGWIN
 
 ifeq (,$(filter-out $(TARGET_OSES),$(OS_TARGET)))
 include $(CORE_DEPTH)/coreconf/$(OS_TARGET).mk
--- origsrc/mozilla/security/nss/cmd/shlibsign/sign.sh	2006-01-18 14:56:28.000000000 -0600
+++ src/mozilla/security/nss/cmd/shlibsign/sign.sh	2008-12-31 22:22:57.971875000 -0600
@@ -1,5 +1,13 @@
 #!/bin/sh
 case "${3}" in
+CYGWIN*)
+    PATH="${1}/lib:${1}/bin:${PATH}"
+    export PATH
+    ADDON_PATH=${1}/lib:${4}:$ADDON_PATH
+    export ADDON_PATH
+    echo ${2}/shlibsign -v -i ${5}
+    ${2}/shlibsign -v -i ${5}
+    ;;
 WIN*)
     if echo "${PATH}" | grep -c \; >/dev/null; then
         PATH=${1}/lib\;${1}/bin\;${4}\;${PATH}
--- origsrc/mozilla/security/nss/lib/ckfw/builtins/config.mk	2005-01-19 20:25:46.000000000 -0600
+++ src/mozilla/security/nss/lib/ckfw/builtins/config.mk	2008-12-31 22:22:57.987500000 -0600
@@ -43,7 +43,6 @@ CONFIG_CVS_ID = "@(#) $RCSfile: config.m
 
 TARGETS        = $(SHARED_LIBRARY)
 LIBRARY        =
-IMPORT_LIBRARY =
 PROGRAM        =
 
 ifeq (,$(filter-out WIN%,$(OS_TARGET)))
--- origsrc/mozilla/security/nss/lib/cryptohi/hasht.h	2005-11-07 12:44:20.000000000 -0600
+++ src/mozilla/security/nss/lib/cryptohi/hasht.h	2009-01-04 18:20:41.735875000 -0600
@@ -84,7 +84,7 @@ struct SECHashObjectStr {
 };
 
 struct HASHContextStr {
-    const struct SECHashObjectStr *hashobj;
+    struct SECHashObjectStr *hashobj;
     void *hash_context;
 };
 
--- origsrc/mozilla/security/nss/lib/freebl/config.mk	2008-10-03 14:40:50.000000000 -0500
+++ src/mozilla/security/nss/lib/freebl/config.mk	2008-12-31 22:22:58.018750000 -0600
@@ -70,7 +70,6 @@ else
 
 TARGETS      = $(SHARED_LIBRARY)
 LIBRARY      =
-IMPORT_LIBRARY =
 PROGRAM      =
 
 ifeq ($(OS_TARGET), SunOS)
--- origsrc/mozilla/security/nss/lib/freebl/unix_rand.c	2008-05-09 18:56:02.000000000 -0500
+++ src/mozilla/security/nss/lib/freebl/unix_rand.c	2008-12-31 23:00:35.237500000 -0600
@@ -186,7 +186,7 @@ static SECStatus RNG_kstat(PRUint32* fed
 
 #if defined(SCO) || defined(UNIXWARE) || defined(BSDI) || defined(FREEBSD) \
     || defined(NETBSD) || defined(DARWIN) || defined(OPENBSD) \
-    || defined(NTO) || defined(__riscos__)
+    || defined(NTO) || defined(__riscos__) || defined(CYGWIN)
 #include <sys/times.h>
 
 #define getdtablesize() sysconf(_SC_OPEN_MAX)
@@ -212,8 +212,10 @@ GiveSystemInfo(void)
     si = sysconf(_SC_CHILD_MAX);
     RNG_RandomUpdate(&si, sizeof(si));
 
+#if defined(_SC_STREAM_MAX)
     si = sysconf(_SC_STREAM_MAX);
     RNG_RandomUpdate(&si, sizeof(si));
+#endif
 
     si = sysconf(_SC_OPEN_MAX);
     RNG_RandomUpdate(&si, sizeof(si));
--- origsrc/mozilla/security/nss/lib/pki1/atav.c	2005-01-19 20:25:49.000000000 -0600
+++ src/mozilla/security/nss/lib/pki1/atav.c	2009-01-04 17:36:24.517125000 -0600
@@ -684,7 +684,7 @@ struct nss_attribute_data_str {
   PRUint32 maxStringLength; /* zero for no limit */
 };
 
-static const struct nss_attribute_data_str nss_attribute_data[] = {
+static struct nss_attribute_data_str nss_attribute_data[] = {
   { &NSS_OID_X520_NAME,                     
     nssStringType_DirectoryString, 1, 32768 },
   { &NSS_OID_X520_COMMON_NAME,              
--- origsrc/mozilla/security/nss/lib/ssl/ssl3ext.c	2008-10-06 17:04:15.000000000 -0500
+++ src/mozilla/security/nss/lib/ssl/ssl3ext.c	2009-01-04 18:58:22.689000000 -0600
@@ -222,7 +222,7 @@ ssl3_GetSessionTicketKeys(const unsigned
  * In the second generation, this table will be dynamic, and functions
  * will be registered here.
  */
-static const ssl3HelloExtensionHandler clientHelloHandlers[] = {
+static ssl3HelloExtensionHandler clientHelloHandlers[] = {
     { server_name_xtn, &ssl3_HandleServerNameXtn },
 #ifdef NSS_ENABLE_ECC
     { elliptic_curves_xtn, &ssl3_HandleSupportedCurvesXtn },
@@ -232,7 +232,7 @@ static const ssl3HelloExtensionHandler c
     { -1, NULL }
 };
 
-static const ssl3HelloExtensionHandler serverHelloHandlers[] = {
+static ssl3HelloExtensionHandler serverHelloHandlers[] = {
     { server_name_xtn, &ssl3_HandleServerNameXtn },
     /* TODO: add a handler for ec_point_formats_xtn */
     { session_ticket_xtn, &ssl3_ClientHandleSessionTicketXtn },
@@ -244,7 +244,7 @@ static const ssl3HelloExtensionHandler s
  * The server's table of hello senders is dynamic, in the socket struct,
  * and sender functions are registered there.
  */
-static const 
+static
 ssl3HelloExtensionSender clientHelloSenders[MAX_EXTENSIONS] = {
     { server_name_xtn, &ssl3_SendServerNameXtn },
 #ifdef NSS_ENABLE_ECC
